<ROSETTASCRIPTS>
    <!--
    RosettaCM Protocol for M. abscessus DNA Gyrase Heterotetramer
    Template: 5BS8 (M. tuberculosis GyrA2-GyrB2)
    
    Complex architecture:
    - Chain A: GyrA subunit 1 (target: 839 aa, template coverage: ~503 aa)
    - Chain B: GyrB subunit 1 (target: 675 aa, template coverage: ~253 aa TOPRIM domain)
    - Chain C: GyrA subunit 2 (target: 839 aa, template coverage: ~503 aa)
    - Chain D: GyrB subunit 2 (target: 675 aa, template coverage: ~253 aa TOPRIM domain)
    
    Usage:
    rosetta_scripts.default.linuxgccrelease \
        -database $ROSETTA_DB \
        -parser:protocol xml/rosettacm_gyrase.xml \
        -in:file:fasta input/target_for_5bs8.fasta \
        -in:file:template_pdb input/templates/5bs8_protein.pdb \
        -nstruct 100 \
        -out:prefix gyrase_mabs_
    -->
    
    <SCOREFXNS>
        <!-- Centroid scoring for initial model building -->
        <ScoreFunction name="stage1" weights="score3" symmetric="0">
            <Reweight scoretype="hbond_sr_bb" weight="1.0"/>
            <Reweight scoretype="hbond_lr_bb" weight="1.0"/>
            <Reweight scoretype="atom_pair_constraint" weight="1.0"/>
            <Reweight scoretype="coordinate_constraint" weight="1.0"/>
        </ScoreFunction>
        
        <!-- Cartesian scoring for refinement -->
        <ScoreFunction name="stage2" weights="score4_smooth_cart" symmetric="0">
            <Reweight scoretype="atom_pair_constraint" weight="0.5"/>
            <Reweight scoretype="coordinate_constraint" weight="0.5"/>
        </ScoreFunction>
        
        <!-- Full-atom scoring -->
        <ScoreFunction name="fullatom" weights="ref2015_cart" symmetric="0">
            <Reweight scoretype="atom_pair_constraint" weight="0.5"/>
            <Reweight scoretype="coordinate_constraint" weight="0.5"/>
        </ScoreFunction>
    </SCOREFXNS>
    
    <RESIDUE_SELECTORS>
        <!-- Select GyrA chains -->
        <Chain name="gyrA_chains" chains="A,C"/>
        
        <!-- Select GyrB chains -->
        <Chain name="gyrB_chains" chains="B,D"/>
        
        <!-- Interface between GyrA and GyrB -->
        <InterfaceByVector name="gyrAB_interface" grp1_selector="gyrA_chains" grp2_selector="gyrB_chains"/>
        
        <!-- GyrA-GyrA interface (C-gate) -->
        <Chain name="chainA" chains="A"/>
        <Chain name="chainC" chains="C"/>
        <InterfaceByVector name="gyrA_dimer_interface" grp1_selector="chainA" grp2_selector="chainC"/>
    </RESIDUE_SELECTORS>
    
    <TASKOPERATIONS>
        <InitializeFromCommandline name="init"/>
        <IncludeCurrent name="include_current"/>
        <RestrictToRepacking name="repack_only"/>
    </TASKOPERATIONS>
    
    <MOVERS>
        <!--
        Hybridize mover - main RosettaCM engine
        Builds model by recombining fragments from template
        -->
        <Hybridize name="hybridize"
            stage1_scorefxn="stage1"
            stage2_scorefxn="stage2"
            fa_scorefxn="fullatom"
            batch="1"
            stage1_increase_cycles="1.0"
            stage2_increase_cycles="1.0"
            linmin_only="0"
            realign_domains="0"
            add_hetatm="0"
            disulf_file="AUTO">
            <!-- Template will be loaded from command line -->
            <Template pdb="input/templates/5bs8_protein.pdb" cst_file="AUTO" weight="1.0"/>
        </Hybridize>
        
        <!-- Relaxation to optimize final structure -->
        <FastRelax name="relax"
            scorefxn="fullatom"
            repeats="2"
            cartesian="1">
            <MoveMap name="relax_mm">
                <Chain number="1" chi="1" bb="1"/>
                <Chain number="2" chi="1" bb="1"/>
                <Chain number="3" chi="1" bb="1"/>
                <Chain number="4" chi="1" bb="1"/>
            </MoveMap>
        </FastRelax>
        
        <!-- Interface minimization -->
        <MinMover name="minimize_interface"
            scorefxn="fullatom"
            type="lbfgs_armijo_nonmonotone"
            tolerance="0.001"
            max_iter="200"
            cartesian="1">
            <MoveMap>
                <ResidueSelector selector="gyrAB_interface" chi="1" bb="1"/>
            </MoveMap>
        </MinMover>
    </MOVERS>
    
    <FILTERS>
        <ScoreType name="total_score" scorefxn="fullatom" threshold="999999"/>
    </FILTERS>
    
    <PROTOCOLS>
        <Add mover="hybridize"/>
        <Add mover="relax"/>
    </PROTOCOLS>
    
    <OUTPUT scorefxn="fullatom"/>
    
</ROSETTASCRIPTS>
